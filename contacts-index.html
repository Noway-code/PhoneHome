<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Intergalactic Connections</title>
        <script type="text/javascript" src="js/md5.js"></script>
        <script type="text/javascript" src="js/code.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <link href="css/contacts-styles.css" rel="stylesheet">


        <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
    </head>


    <body>
        <div id="logOutContainer">
                <!-- Maybe could use "Terminate Connection" as message instead? -->
            <button type="button" class="btn btn-dark btn-lg" onclick="doLogout()();">
                Protocol: Log Out 
            </button>
        </div>
        
        <h1 id="title">Intergalactic Connections</h1>
        
        <div id="searchBarContainer">
            <input type="text" id="searchBar" placeholder="Search">
        </div>

        <div id="contactsContainer">

            <table>
                <tr id="headerRow" class="bg-dark">
                    <th>Primary Identifier</th>
                    <th>Secondary Identifier</th>
                    <th>Number Code</th>
                    <th>Contact Address</th>
                    <th>Protocols</th>
                </tr>
<!--                 <tr>
                    <td>
                        <input type="text" class="inputInfo" id="firstName" placeholder="First name" required>
                    </td>
                    <td>
                        <input type="text" class="inputInfo" id="lastName" placeholder="Last name" required>
                    </td>
                    <td>
                        <input type="text" class="inputInfo" id="number" placeholder="Phone number" required>
                    </td>
                    <td>
                        <input type="email" class="inputInfo" id="email" placeholder="Email" required>
                    </td>
                    <td>
                        <button id="editButton" type="button" class="btn btn-dark" onclick="editContact();">
                            Modify 
                        </button>
                        <button id="deleteButton" type="button" class="btn btn-dark" onclick="deleteContact();">
                            Destroy 
                        </button>
                        <button id="addContactButton" type="button" class="btn btn-dark" onclick="addContactHandler();">
                            Append Entry 
                        </button>
                    </td>
                </tr> -->
            </table>

        </div>


        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

        <script>
            var rowID = -1;
            // Loads the first 10 contacts (if they exist) from the database
            function fetchFirstLoadedContacts() {

            }
            function editContact() {
                // Find table row to be modified using RegEx
                let ID = event.srcElement.id;
                let currentRowID = ID.match(/\d+/);


                // Make current row modifiable
                unlockInput(currentRowID);

                // Change "Edit" button to "Done"
                $("#editButton" + currentRowID).hide();
                $("#deleteButton" + currentRowID).hide();
                $("#doneButton" + currentRowID).show();


                //alert("editing contact");
            }
            function doneEditingHandler() {
                // Find table row to be modified using RegEx
                let ID = event.srcElement.id;
                let currentRowID = ID.match(/\d+/);


                // Grab and store each field in a variable from current row
                let firstName = $("#firstName" + currentRowID).val();
                let lastName = $("#lastName" + currentRowID).val();
                let phoneNumber = $("#number" + currentRowID).val();
                let email = $("#email" + currentRowID).val();

                // Function call to editContact with proper values


                // Make current row unmodifiable
                lockInput(currentRowID);

                // change buttons to "Edit" and "Delete"
                $("#doneButton" + currentRowID).hide();
                $("#editButton" + currentRowID).show();
                $("#deleteButton" + currentRowID).show();
            }
            function deleteContact() {
                // Find table row to be deleted using RegEx
                let ID = event.srcElement.id;
                let currentRowID = ID.match(/\d+/);

                // Grab and store each field in a variable from current row
                let firstName = $("#firstName" + currentRowID).val();
                let lastName = $("#lastName" + currentRowID).val();

                // Function call to deleteContact
                deleteContact(firstName, lastName, parseInt(localStorage.getItem("userId")));

                // Remove row from table
                $("#" + currentRowID).remove();

                alert("deleted contact");
            }
            function addContactHandler() {
                // Grab and store each field in a variable from current row
                let firstName = $("#firstName" + rowID).val();
                let lastName = $("#lastName" + rowID).val();
                let phoneNumber = $("#number" + rowID).val();
                let email = $("#email" + rowID).val();

                
                // Function call to addContact with proper values
                //alert("Contact made with " + firstName + " " + lastName + " " + phoneNumber + " " + email);
                addContact(firstName, lastName, phoneNumber, email);

                // Make current row unmodifiable
                lockInput(rowID);

                // change "Add contact" button to "Edit" and "Delete"
                $("#addContactButton" + rowID).hide();
                $("#editButton" + rowID).show();
                $("#deleteButton" + rowID).show();

                // Append new empty contacts row
                createEmptyContactRow();
                //alert("added contact");
            }
            function lockInput(currentRowID) {
                $("#firstName" + currentRowID).prop("readonly", true);
                $("#lastName" + currentRowID).prop("readonly", true);
                $("#number" + currentRowID).prop("readonly", true);
                $("#email" + currentRowID).prop("readonly", true);

                $("#firstName" + currentRowID).css({
                    'border': 'none',
                    'background': 'transparent'
                });
                $("#lastName" + currentRowID).css({
                    'border': 'none',
                    'background': 'transparent'
                });
                $("#number" + currentRowID).css({
                    'border': 'none',
                    'background': 'transparent'
                });
                $("#email" + currentRowID).css({
                    'border': 'none',
                    'background': 'transparent'
                });
            }
            function unlockInput(currentRowID) {
                $("#firstName" + currentRowID).prop("readonly", false);
                $("#lastName" + currentRowID).prop("readonly", false);
                $("#number" + currentRowID).prop("readonly", false);
                $("#email" + currentRowID).prop("readonly", false);

                $("#firstName" + currentRowID).css({
                    'border': '1px solid grey',
                    'background': 'white'
                });
                $("#lastName" + currentRowID).css({
                    'border': '1px solid grey',
                    'background': 'white'
                });
                $("#number" + currentRowID).css({
                    'border': '1px solid grey',
                    'background': 'white'
                });
                $("#email" + currentRowID).css({
                    'border': '1px solid grey',
                    'background': 'white'
                });
            }
            function createEmptyContactRow() {
                $("table").append(createEmptyContactRowHelper());  
                $("#addContactButton" + rowID).show();
                $("#editButton" + rowID).hide();
                $("#deleteButton" + rowID).hide();
                $("#doneButton" + rowID).hide();
            }
            function createContact(fName, lName, pNumber, email) {
                $("table").append(createContactHelper(fName, lName, pNumber, email));  
                $("#addContactButton" + rowID).show();
                $("#editButton" + rowID).hide();
                $("#deleteButton" + rowID).hide();
                $("#doneButton" + rowID).hide();
            }
            function createEmptyContactRowHelper() {     
                rowID++;
                return '<tr id="' + rowID + '"><td><input type="text" class="inputInfo" id="firstName' + rowID + '" placeholder="First name" required></td><td><input type="text" class="inputInfo" id="lastName' + rowID + '" placeholder="Last name" required></td><td><input type="text" class="inputInfo" id="number' + rowID + '" placeholder="Phone number" required></td><td><input type="email" class="inputInfo" id="email' + rowID + '" placeholder="Email" required></td><td><button id="editButton' + rowID + '" type="button" class="btn btn-dark" onclick="editContact();";>Modify</button><button id="deleteButton' + rowID + '" type="button" class="btn btn-dark" onclick="deleteContact();";>Destroy</button><button id="doneButton' + rowID + '" type="button" class="btn btn-dark" onclick="doneEditingHandler();";>Done</button><button id="addContactButton' + rowID + '" type="button" class="btn btn-dark" onclick="addContactHandler();";>Append Entry</button></td></tr>';
            }
            function createContactHelper(fName, lName, pNumber, email) {     
                rowID++;
                return '<tr id="' + rowID + '"><td><input type="text" class="inputInfo" id="firstName' + rowID + '" placeholder="' + fName + '" required></td><td><input type="text" class="inputInfo" id="lastName' + rowID + '" placeholder="Last name" required></td><td><input type="text" class="inputInfo" id="number' + rowID + '" placeholder="Phone number" required></td><td><input type="email" class="inputInfo" id="email' + rowID + '" placeholder="Email" required></td><td><button id="editButton' + rowID + '" type="button" class="btn btn-dark" onclick="editContact();";>Modify</button><button id="deleteButton' + rowID + '" type="button" class="btn btn-dark" onclick="deleteContact();";>Destroy</button><button id="doneButton' + rowID + '" type="button" class="btn btn-dark" onclick="doneEditingHandler();";>Done</button><button id="addContactButton' + rowID + '" type="button" class="btn btn-dark" onclick="addContactHandler();";>Append Entry</button></td></tr>';
            }
        
            $(document).ready(function () {
                $("table").append(createEmptyContactRow());  
                $("table").append(createContact("david", "david", "david", "david"));              
            });


        </script>

    </body>
</html>
